{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro de Usuário - Futuras Cientistas</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen flex items-center justify-center bg-pink-400 p-4">

  <!-- Background bolhas -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="absolute -right-20 top-20 w-96 h-96 bg-white rounded-full transform rotate-12 opacity-80"></div>
    <div class="absolute right-40 top-80 w-80 h-80 bg-white rounded-full transform -rotate-12 opacity-80"></div>
    <div class="absolute right-10 bottom-20 w-72 h-72 bg-white rounded-full transform rotate-45 opacity-80"></div>
  </div>

  <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md z-10 relative">

    <!-- Logo -->
    <div class="relative mb-6" style="height: 37px; margin-bottom: 24px;">
      <img src="{% static 'public/images/futuras-cientistas-logo-positive.png' %}" alt="Futuras Cientistas" class="absolute top-0 left-0" style="width: 178px; height: 37px;">
    </div>

    <h1 class="text-2xl font-bold text-gray-800 mb-1">Cadastro primeiro acesso</h1>
    <p class="text-sm text-gray-600 mb-4">
      Já tem uma conta?
      <a href="{% url 'login' %}" class="text-pink-500 hover:underline">ENTRE</a>
    </p>

    <!-- Mensagem de sucesso -->
    {% if success_message %}
      <div class="mb-4 bg-green-50 border border-green-200 text-green-800 rounded p-2 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
        <span>{{ success_message }}</span>
      </div>
    {% endif %}

    <!-- Mensagem de erro geral -->
    {% if form.non_field_errors %}
      <div class="mb-4 bg-red-50 border border-red-200 text-red-800 rounded p-2 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        <span>{{ form.non_field_errors }}</span>
      </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}
      
      <!-- Email -->
      <div class="mt-4">
        <label for="{{ form.email.id_for_label }}" class="text-sm font-medium">
          E-mail<span class="text-pink-500">*</span>
        </label>
        {{ form.email }}
        <p class="text-red-500 text-xs mt-1">{{ form.email.errors|first }}</p>
      </div>
      <!-- Nome -->
      <div class="mt-4">
        <label for="{{ form.nome.id_for_label }}" class="text-sm font-medium">
          Nome completo<span class="text-pink-500">*</span>
        </label>
        {{ form.nome }}
        <p class="text-red-500 text-xs mt-1">{{ form.nome.errors|first }}</p>
      </div>
      <!-- CPF -->
      <div class="mt-4">
        <label for="{{ form.cpf.id_for_label }}" class="text-sm font-medium">
          CPF<span class="text-pink-500">*</span>
        </label>
        {{ form.cpf }}
        <p id="cpf-error" class="text-red-500 text-xs mt-1">{{ form.cpf.errors|first }}</p>
      </div>
      <!-- Grupo (select) -->
      <div class="mt-4">
        <label for="{{ form.group.id_for_label }}" class="text-sm font-medium">
          Função<span class="text-pink-500">*</span>
        </label>
        {{ form.group }}
        <p id="group-error" class="text-red-500 text-xs mt-1">{{ form.group.errors|first }}</p>
      </div>
      <!-- Senha -->
      <div class="mt-4">
        <label for="{{ form.password.id_for_label }}" class="text-sm font-medium">
          Senha<span class="text-pink-500">*</span>
        </label>
        {{ form.password }}
        <p id="password-error" class="text-red-500 text-xs mt-1">{{ form.password.errors|first }}</p>
      </div>
      <!-- Confirmar senha -->
      <div class="mt-4">
        <label for="id_confirm_password" class="text-sm font-medium">
          Confirmar senha<span class="text-pink-500">*</span>
        </label>
        <input
          type="password"
          id="id_confirm_password"
          name="confirm_password"
          placeholder="Confirme a senha"
          class="mt-1 block w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-pink-400"
          required
          oninput="validateConfirmPassword()"
        />
        <p id="confirm-password-error" class="text-red-500 text-xs mt-1"></p>
      </div>

      <div class="text-xs text-gray-500 mt-2 mb-4">* Campos obrigatórios</div>

      <button
        type="submit"
        class="w-full bg-pink-400 hover:bg-pink-500 text-white font-semibold py-2 rounded flex justify-center items-center"
      >
        Salvar
        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
        </svg>
      </button>
    </form>

  </div>

  <script>
    // Validação simples e mascaras no frontend

    function validateEmail() {
      const emailInput = document.getElementById("id_email");
      const emailError = document.getElementById("email-error");
      const email = emailInput.value;
      const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!email) {
        emailError.textContent = "O email é obrigatório";
        emailInput.classList.add("border-red-500", "focus:ring-red-500");
        return false;
      }
      if (!regex.test(email)) {
        emailError.textContent = "Formato de email inválido";
        emailInput.classList.add("border-red-500", "focus:ring-red-500");
        return false;
      }
      emailError.textContent = "";
      emailInput.classList.remove("border-red-500", "focus:ring-red-500");
      return true;
    }

    function clearEmailError() {
      const emailError = document.getElementById("email-error");
      const emailInput = document.getElementById("id_email");
      emailError.textContent = "";
      emailInput.classList.remove("border-red-500", "focus:ring-red-500");
    }

    function formatCPF(field) {
      let value = field.value.replace(/\D/g, "").slice(0, 11);
      if (value.length > 9) {
        value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
      } else if (value.length > 6) {
        value = value.replace(/(\d{3})(\d{3})(\d{3})/, "$1.$2.$3");
      } else if (value.length > 3) {
        value = value.replace(/(\d{3})(\d{3})/, "$1.$2");
      }
      field.value = value;
    }

    function validateCPF() {
      const cpfInput = document.getElementById("id_cpf");
      const cpfError = document.getElementById("cpf-error");
      const cpf = cpfInput.value;
      const cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;

      if (!cpf) {
        cpfError.textContent = "O CPF é obrigatório";
        cpfInput.classList.add("border-red-500", "focus:ring-red-500");
        return false;
      }
      if (!cpfRegex.test(cpf)) {
        cpfError.textContent = "Formato de CPF inválido. Use o formato 000.000.000-00";
        cpfInput.classList.add("border-red-500", "focus:ring-red-500");
        return false;
      }

      cpfError.textContent = "";
      cpfInput.classList.remove("border-red-500", "focus:ring-red-500");
      return true;
    }

    function updatePasswordStrength() {
      const pwdInput = document.getElementById("id_password");
      const pwd = pwdInput.value;

      let strength = 0;
      if (pwd.length > 6) strength++;
      if (pwd.length > 10) strength++;
      if (/[A-Z]/.test(pwd)) strength++;
      if (/[0-9]/.test(pwd)) strength++;
      if (/[^A-Za-z0-9]/.test(pwd)) strength++;

      strength = Math.min(strength, 4);

      for (let i = 1; i <= 4; i++) {
        const bar = document.getElementById("strength-" + i);
        if (i <= strength) {
          const colors = ["bg-red-500", "bg-orange-500", "bg-yellow-500", "bg-green-500"];
          bar.className = "flex-1 " + colors[i - 1];
        } else {
          bar.className = "flex-1 bg-gray-200";
        }
      }
    }

    function validateConfirmPassword() {
      const pwd = document.getElementById("id_password").value;
      const confirmPwd = document.getElementById("id_confirm_password").value;
      const error = document.getElementById("confirm-password-error");

      if (pwd !== confirmPwd) {
        error.textContent = "As senhas não coincidem";
        return false;
      } else {
        error.textContent = "";
        return true;
      }
    }

    // Validação final antes do submit
    document.querySelector("form").addEventListener("submit", function(event) {
      if (!validateEmail() || !validateCPF() || !validateConfirmPassword()) {
        event.preventDefault();
      }
    });

  </script>

</body>
</html>