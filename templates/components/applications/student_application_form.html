{% extends 'components/dashboard/sidebar/dashboard.html' %} 
{% load widget_tweaks %} 
{% load static %} 

{% block title %}Inscrição para Alunas{% endblock %} 

{% block content %}
<div class="max-w-3xl mx-auto bg-white p-6 rounded shadow-md">

   <!-- Título página -->
   <h1 class="text-2xl font-semibold mb-6 text-gray-900">Inscrição para Alunas</h1>

   <!-- Alerta -->
   <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6" role="alert">
      <span class="font-semibold">Aviso:</span> Você declara ciência sobre a necessidade de seu deslocamento até o local onde será realizado o projeto.
   </div>

   <!-- Indicador de Passo -->
   <div class="step-indicator mb-8">
      <div class="step-inner">
         {% for step in steps %}
            <div class="step-item {% if step.number == current_step %}active{% endif %}" data-step="{{ step.number }}">
               <div class="step-number">{{ step.number }}</div>
               <div class="step-name">{{ step.name }}</div>
            </div>
            {% if not forloop.last %}
               <div class="step-connector"></div>
            {% endif %}
         {% endfor %}
      </div>
   </div>

   <!-- Verificação de Erro -->
   {% if form.errors %}
      <div id="form-error-alert" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert" aria-live="assertive">
         <strong class="font-bold">Erro ao enviar o formulário!</strong>
         <p class="mt-1">Verifique os seguintes campos:</p>
         <ul class="mt-2 list-disc list-inside">
            {% for field_name, field in current_step_fields %}
               {% if field.errors %}
                  <li>{{ field.label }}</li>
               {% endif %}
            {% endfor %}
            {% if form.non_field_errors %}
               {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
               {% endfor %}
            {% endif %}
         </ul>
      </div>
   {% endif %}


   {% if messages %}
   <div class="fixed top-5 right-5 space-y-4 z-50">
      {% for message in messages %}
      <div role="alert" data-autoclose="true"
         class="flex items-center justify-between px-4 py-3 rounded-lg shadow-lg transition transform duration-300
         {% if message.tags == 'success' %} bg-green-500 text-white
         {% elif message.tags == 'error' or message.tags == 'danger' %} bg-red-500 text-white
         {% elif message.tags == 'warning' %} bg-yellow-500 text-white
         {% else %} bg-blue-500 text-white {% endif %}">
         <span class="font-semibold">{{ message }}</span>
         <button type="button" class="ml-4" onclick="this.closest('[role=alert]').remove()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
         </button>
      </div>
      {% endfor %}
   </div>
   {% endif %}

   <form id="student-form" method="post" enctype="multipart/form-data" novalidate>
      {% csrf_token %}
      <input type="hidden" name="current_step" id="current_step" value="{{ current_step }}">
      <div class="form-step" id="step-{{ current_step }}">
         <h2 class="text-lg font-semibold text-gray-900 mb-2">
            {{ current_step }}. {{ step_title }}
         </h2>


         {% for field_name, field in current_step_fields %}
            <div class="mb-4">
               {% if field.field.widget.input_type == "file" %}
                     {% include "components/applications/form_field.html" with field=field form=form%}
               {% elif current_step != 5 %}
                     <label for="{{ field.id_for_label }}" class="block font-semibold mb-1 text-gray-800">
                        {{ field.label }} {% if field.field.required %}<span class="text-red-600">*</span>{% endif %}
                     </label>
                     {% render_field field class="block w-full rounded border border-gray-300 px-3 py-2" %}
                     
               {% else %}
                     <div class="flex items-start">
                        <input type="checkbox" name="{{ field.html_name }}" id="{{ field.id_for_label }}"
                              class="h-4 w-4 text-pink-600 focus:ring-pink-500 border-gray-300 rounded"
                              {% if field.value %}checked{% endif %}>
                        <label for="{{ field.id_for_label }}" class="ml-2 block text-sm text-gray-700">
                           {{ field.label }}
                        </label>
                        {% if field.errors %}
                           <ul class="errorlist mt-1">
                                 {% for error in field.errors %}
                                    <li>{{ error }}</li>
                                 {% endfor %}
                           </ul>
                        {% endif %}
                     </div>
               {% endif %}
            </div>
         {% endfor %}

         <div class="flex items-center justify-between mt-4">

            <div class="left-actions flex items-center space-x-2">
               {% if current_step > 1 %}
                  <button type="submit" name="acao" value="voltar" 
                        data-navigation="{{ current_step|add:'-1' }}"
                        class="bg-gray-300 px-4 py-2 rounded">Voltar</button>
               {% endif %}
            </div>

            <div class="right-actions flex items-center space-x-2">
               {% if current_step in steps_with_save %}
                  <button type="submit" name="acao" value="salvar" 
                        class="bg-gray-300 text-gray-800 px-4 py-2 rounded">
                     Salvar rascunho
                  </button>
               {% endif %}

               {% if current_step < steps|length %}
                  <button type="submit" name="acao" value="proximo" 
                        class="bg-pink-500 text-white px-4 py-2 rounded">Próximo</button>
               {% endif %}

               {% if current_step == steps|length %}
                  <button type="submit" name="acao" value="enviar" 
                        class="bg-pink-500 text-white px-4 py-2 rounded">Enviar</button>
               {% endif %}
            </div>
         </div>
         
      </div>
   </form>

</div>

<div id="loading-overlay" class="hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 z-50">
   <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-pink-500 border-solid"></div>
</div>

<style>
   .errorlist {
      color: #dc2626;
      font-size: 0.875rem;
      margin-top: 0.25rem;
      list-style-type: none;
      padding-left: 0;
   }

   .step-indicator {
      display: flex;
      justify-content: center; 
      align-items: center;
      width: 100%;
   }

   .step-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
   }
   
   .step-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
      cursor: pointer;
      text-align: center;
   }
   
   .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #e5e7eb;
      color: #6b7280;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-bottom: 8px;
      transition: all 0.3s ease;
      flex-shrink: 0;
   }
   
   .step-name {
      font-size: 0.75rem;
      color: #9ca3af;
      text-align: center;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 80px; 
   }
   
   .step-connector {
      flex-grow: 1; 
      height: 2px;
      background-color: #e5e7eb;
      margin: 0 5px; 
   }
   
   .step-item.active .step-number {
      background-color: #ec4899;
      color: white;
   }
   
   .step-item.active .step-name {
      color: #4b5563;
      font-weight: 500;
   }
   
   /* Layout responsivo */
   @media (max-width: 768px) {
      .step-name {
         max-width: 60px;
         font-size: 0.65rem;
      }
      .step-connector {
         width: 20px;
      }
   }
</style>

<script src="{% static 'js/student_forms.js' %}"></script>

{% endblock %}